# yaml-language-server: $schema=https://carapace.sh/schemas/command.json
name: set-config
description: Modify the current Autopilot configuration
flags:
    --ca-file=: Path to a CA file to use for TLS when communicating with Consul.
    --ca-path=: Path to a directory of CA certificates to use for TLS when communicating with Consul.
    --cleanup-dead-servers=: Controls whether Consul will automatically remove dead servers when new ones are successfully added.
    --client-cert=: Path to a client cert file to use for TLS when 'verify_incoming' is enabled.
    --client-key=: Path to a client key file to use for TLS when 'verify_incoming' is enabled.
    --datacenter=: Name of the datacenter to query.
    --disable-upgrade-migration=: (Enterprise-only) Controls whether Consul will avoid promoting new servers until it can perform a migration.
    --http-addr=: The `address` and port of the Consul HTTP agent.
    --last-contact-threshold=: Controls the maximum amount of time a server can go without contact from the leader before being considered unhealthy.
    --max-trailing-logs=: Controls the maximum number of log entries that a server can trail the leader by before being considered unhealthy.
    --min-quorum=: Sets the minimum number of servers required in a cluster before autopilot is allowed to prune dead servers.
    --redundancy-zone-tag=: (Enterprise-only) Controls the node_meta tag name used for separating servers into different redundancy zones.
    --server-stabilization-time=: Controls the minimum amount of time a server must be stable in the 'healthy' state before being added to the cluster.
    --stale: Permit any Consul server (non-leader) to respond to this request.
    --tls-server-name=: The server name to use as the SNI host when connecting via TLS.
    --token-file=: File containing the ACL token to use in the request.
    --token=: ACL token to use in the request.
    --upgrade-version-tag=: (Enterprise-only) The node_meta tag to use for version info when performing upgrade migrations.
documentation:
    command: '[AI] `consul operator autopilot set-config` is a command used with the Consul Service Mesh Operator for Kubernetes. This command is employed to update the configuration of the Consul Autopilot, which is a feature that automates service discovery and traffic management within the Consul ecosystem. By using `set-config`, users can modify various aspects of the Consul Autopilot configuration, such as enabling or disabling specific features, adjusting resource limits, or modifying network policies. The updated configuration is then applied to the running Consul deployment in the Kubernetes cluster.'
    flag:
        ca-file: '[AI] The `consul operator autopilot set-config --ca-file` command is used to configure Consul, a connectivity and service discovery tool, using the Operator framework in an autopilot mode. The `--ca-file` flag refers to the path of a CA (Certifying Authority) certificate file that will be used to sign and encrypt the communication between Consul components. By providing this configuration, you are enabling secure communication between Consul servers and clients within your cluster.'
        ca-path: '[AI] The `consul operator autopilot set-config --ca-path` command is used with Hashicorp''s Consul service, an open-source tool for service discovery, configuration, and orchestration. This specific command is used to configure the Consul Operator, which is a Kubernetes native mode for running Consul, by setting the CA path for TLS certificates. The `--ca-path` flag indicates the location of the Certificate Authority (CA) files that will be used to sign and validate the certificates for secure communication between different components within the Consul cluster or with client applications. In summary, this command sets the CA path in the Consul Operator configuration.'
        cleanup-dead-servers: |-
            [AI] The `consul operator autopilot set-config --cleanup-dead-servers` command is used with Hashicorp Consul's Kubernetes Operator to manage and configure the Consul service discovery and configuration syncing in a Kubernetes environment.

            More specifically, this command triggers the "autopilot" mode of the operator, which automatically manages and adjusts Consul clusters based on detected changes within the Kubernetes infrastructure. The `--cleanup-dead-servers` flag instructs the operator to remove any dead or unreachable Consul servers from the managed cluster, ensuring that only healthy servers are included in the Consul service discovery and configuration syncing process.
        client-cert: '[AI] The `consul operator autopilot set-config --client-cert` command is used with the Consul Kubernetes Operator to configure client certificates for secure communication between Consul and clients accessing its services. The `set-config` subcommand modifies the Consul configuration, while the `--client-cert` flag specifies the path or volume mount containing the client certificate file. This command ensures that clients interacting with the Consul service discovery platform have encrypted and authenticated communication.'
        client-key: |-
            [AI] The `consul operator autopilot set-config --client-key` command is used to configure Consul, an open-source distributed computing platform, using the Consul Operator and its Autopilot mode.

            This command sets a configuration item for Consul using the specified client key. The client key identifies the specific configuration property to be updated. For example, `--client-key=bind-address` might be used to set the IP address on which Consul listens for incoming connections.

            The Consul Operator's Autopilot mode automates various aspects of managing Consul, allowing users to declaratively configure their clusters without writing Kubernetes manifests or scripts. The `set-config` subcommand is part of this workflow and enables updating the configuration values as needed without directly interacting with the underlying Consul codebase.
        datacenter: |-
            [AI] The `consul operator autopilot set-config --datacenter` command is used to configure Consul, a distributed computing platform for service discovery, configuration, and orchestration, using the Operator framework in an autopilot mode.

            The `set-config` subcommand is responsible for setting various configurations for Consul. In this context, it is specifically being used to set the datacenter configuration. The datacenter defines a logical grouping of servers and clients within a Consul cluster. By specifying the datacenter with this command, you are configuring Consul to operate within that particular datacenter.

            This command is typically run in Kubernetes environments where Consul is being deployed as a managed service using the Operator. The autopilot mode enables the Operator to automatically manage and configure Consul based on the provided configurations.
        disable-upgrade-migration: '[AI] The `consul operator autopilot set-config --disable-upgrade-migration` command is used with the Consul Service Mesh Operator to disable automatic upgrades and migration of configuration changes in the Consul service mesh environment. This means that any updates or modifications to the configuration files will not be applied through automated processes, but rather require manual intervention for implementation. This could be useful when testing new configurations or performing sensitive updates where a more controlled approach is preferred over an automated one.'
        http-addr: '[AI] The `consul operator autopilot set-config --http-addr` command is used to configure the Consul service, which is a Connect and Keyvalue store, with an updated HTTP address for its Control Plane interface. The Consul Operator is a Kubernetes native application that simplifies deployment and management of a Consul service in a Kubernetes cluster. The `autopilot` mode enables automatic configuration of the operator based on the Consul values in your Kubernetes configuration files. The `set-config` subcommand allows you to update specific configurations, and the `--http-addr` flag sets the new HTTP address for the Control Plane interface.'
        last-contact-threshold: |-
            [AI] The `consul operator autopilot set-config --last-contact-threshold` command is used with Hashicorp Consul, a distributed, highly available, and data center aware solution connecting and coordinating applications within and across data centers. The `autopilot` feature enables Consul to automatically detect and configure services.

            The `set-config` subcommand here is for configuring the Autopilot. Specifically, the `--last-contact-threshold` flag sets the amount of time (in seconds) that must elapse since a service was last contacted before it's considered unhealthy and removed from the service discovery pool by Consul. This value can be adjusted to accommodate varying application responsiveness or network conditions.
        max-trailing-logs: |-
            [AI] The `consul operator autopilot set-config --max-trailing-logs` command is used with Hashicorp's Consul service, which is a distributed, highly available, and data center aware toolkit for managing configurations, orchestrating applications, and connecting services.

            The `autopilot` feature of the Consul Operator enables the automated management of Consul clusters. The `set-config` subcommand is used to configure various aspects of the Consul cluster. In this specific case, the `--max-trailing-logs` flag sets the maximum number of logs kept for each service in the Consul's built-in logging feature called "trailing logs".

            The value provided with this flag will determine how many logs are kept for each service. For instance, if you set `--max-trailing-logs 10`, then Consul will keep the last 10 log entries for every service in the trailing logs. This command helps manage the available storage and performance of the logging feature by setting an appropriate limit on the number of logs to keep.
        min-quorum: '[AI] The `consul operator autopilot set-config --min-quorum` command is used with the Consul Toolkit, which is a set of tools for deploying and managing Consul service mesh and configuration management. This specific command sets the minimum number of servers required to reach a quorum in an Consul cluster, also known as the Raft consensus algorithm''s replica agreement. The `--min-quorum` flag sets this value. A lower quorum means fewer servers are required for agreement, but it increases the risk of data loss if some servers fail. Conversely, a higher quorum provides greater fault tolerance at the cost of increased latency and resource usage.'
        redundancy-zone-tag: |-
            [AI] The `consul operator autopilot set-config --redundancy-zone-tag` command is used with Hashicorp Consul, an open-source tool for service discovery, configuration, and orchestration. This specific command sets the tag for redundancy zones in Consul's Autopilot mode.

            Redundancy zones help ensure high availability by distributing services across multiple availability zones or datacenters. The `--redundancy-zone-tag` flag allows you to specify a custom tag for these zones, which can be used for organizing and managing them within Consul's interface. This command updates the configuration of an existing Consul cluster to use the specified redundancy zone tag.
        server-stabilization-time: |-
            [AI] The `consul operator autopilot set-config --server-stabilization-time` command is used with the Consul Kubernetes Operator to configure the server stabilization time.

            Consul is a distributed, highly available, and data center aware toolkit for configuring and connecting microservices. The Consul operator simplifies the deployment of Consul by managing Consul servers as Kubernetes stateful sets.

            The `--server-stabilization-time` flag sets the length of time that new servers are considered unstable before they can be promoted to active duty in a Consul cluster. This helps ensure that newly joined servers have had enough time to sync data and stabilize before being included in the cluster's Raft consensus algorithm, improving overall cluster stability.

            The value provided with this flag is the duration, specified in seconds. For example, `--server-stabilization-time 300` sets the stabilization time to 5 minutes (300 seconds).
        stale: '[AI] The `consul operator autopilot set-config --stale` command is used to update the configuration of a Consul service mesh using the Operator, specifically the Autopilot mode. The `--stale` flag indicates that Consul should apply the new configuration even if there are currently running services or workloads that depend on the old configuration. In other words, it allows for a rolling update of the configuration with potential disruption to active services. The change will be marked as stale until all dependent services have successfully transitioned to the new configuration, at which point it becomes healthy again.'
        tls-server-name: '[AI] The `consul operator autopilot set-config --tls-server-name` command is used with the Consul Kubernetes Operator to configure the TLS server name for secure communication between the Consul service and its clients, such as other applications or services. This configuration ensures that only trusted entities can connect to the Consul server using Transport Layer Security (TLS). The specified `--tls-server-name` argument sets the server name or certificate used in the TLS connection, which is essential for proper authentication and encryption in a production environment.'
        token: '[AI] The `consul operator autopilot set-config --token` command is used with the Consul Service Mesh Operator to configure its behavior using an unauthenticated or authenticated Consul token. This command sets specific configuration options for the Autopilot feature of the Consul Operator, which automates various tasks related to managing a service mesh. The `--token` argument is used to provide an optional token for authentication, ensuring only authorized users can modify the configuration.'
        token-file: '[AI] The `consul operator autopilot set-config` command is used to configure Consul, a Connect and Service Mesh platform, using the Autopilot mode of the Consul Operator. The `--token-file` flag specifies the path to a file containing an API token that provides the necessary permissions for making configuration changes. This command allows you to set various configuration parameters for your Consul deployment in a declarative way, ensuring that your desired state is automatically maintained by the Consul Operator.'
        upgrade-version-tag: '[AI] The `consul operator autopilot set-config --upgrade-version-tag` command is used with the Consul Kubernetes Operator to configure and manage a Consul cluster running in a Kubernetes environment. Specifically, this command sets the version tag for upgrading Consul to a newer release using the Consul Operator''s autopilot feature, which automatically manages and maintains the desired state of the Consul cluster based on the provided configuration. The `--upgrade-version-tag` flag indicates the specific version tag of the Consul release that should be upgraded to.'
